<!DOCTYPE html>
<html>
<head>
<title>Bootstrap 101 Template</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Bootstrap -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="jquery-modal/jquery.modal.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
<style>
    .container .selected {
        background-color: #A7EBBF;
    }

    body .container tr.selected td {
        background-color: #A7EBBF;
    }

    .container tr.hover {
        cursor: pointer;
    }

    .crud-save-form .status {
        width: 100px;
    }

    .crud-edit-form {}

    .crud-create-form {}

    .crud-pages {
        display:block;
        margin: 0;
        padding: 0;
    }

    /*should not be given margin (messes up calculation to determine number
      of paginator pages to render)*/
    /*REQUIRED*/
    .crud-pages li {
        float: left;
    }

    .crud-goto-page-form {
        float: right;
    }

    body .crud-input-group {
        position: relative;
        top: 3px;
        margin: 0.7em 0.3em 0 0.3em;
    }

    .modal {
        height: 125px;
        width: 250px;
        overflow: hidden;
    }

    .btn {
        margin: 0.2em;
    }

    .error {
        color: rgb(236, 37, 37);
    }

    body .crud-list-select-all {
        position: relative;
        top: 2px;
        margin: 0.3em;
    }
</style>
</head>

<body>
<div class="container">
    <h1>CRUD</h1>
    <hr/>
    <div class="row">
        <div id="Thing-crud-container" class="col-sm-6"></div>
        <div id="Thing-crud-filter-container" class="col-sm-6"></div>
    </div>
    <div class="row">
        <div id="Thing-crud-paginator-nav" class="col-sm-12"></div>
    </div>
    <div class="row">
        <div id="Thing-crud-list-container" class="col-sm-12"></div>
    </div>
</div>

<script src="lib/jquery-1.10.2.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="lib/mustache.js"></script>
<script src="jquery-modal/jquery.modal.js"></script>
<script src="crud.js"></script>
<script>
$(document).ready(function () {
    'use strict';

    //utility function to help with building html strings from objects.
    var reduce = function (collection, callback) {
        var accumulation, key;
        for(key in collection) {
            if(collection.hasOwnProperty(key)) {
                accumulation = callback(accumulation, collection[key], key, collection);
            }
        }
        return accumulation;
    };

    var reduceSchemaToForm = function (fig) {
        return reduce(fig.schema, function (acc, item) {
            var className = '';
            switch(item.type) {
                case 'text':
                case 'textarea':
                case 'password':
                case 'select':
                    className = "form-control";
                    break;
                case 'radio':
                case 'checkbox':
                    className = "crud-input-group";
                    break;
                default:
                    throw "invalid input type: " + item.type;
            }
            return (acc || '') +
            '<div class="form-group">' +
                '<label for="' + fig.ID + '-' + fig.name + '-' + item.name + '"' +
                       'class="col-sm-3 control-label">' +
                    (item.label || item.name) +
                '</label>' +
                '<div class="col-sm-6">' +
                    fig.createInput({
                        item: item,
                        name: fig.name,
                        class: className,
                        ID: fig.ID
                    }) +
                '</div>' +
                '<div class="col-sm-3 error">' +
                    '{{' + item.name + 'Help}}' +
                '</div>' +
            '</div>';
        });
    }

    createCRUD({
        name: 'Thing',
        url: 'crud.php',
        validate: function (data) {
            var error = {};
            if(data.text !== 'default') {
                error.text = 'text error';
            }
            return error;
        },

        //deletable: false,

        id: {
            orderable: true,
            order: 'ascending',
            label: 'id'
        },

        schema: [
            {
                name: 'text',
                label: 'label yo',
                type: 'text',
                value: 'default'
            },
            {
                name: 'textarea',
                type: 'textarea',
                orderable: true,
                order: 'ascending'
            },
            {
                name: 'fruit',
                type: 'checkbox',
                values: ['apple', 'orange'],
                value: ['orange']
            },
            {
                name: 'letter',
                type: 'radio',
                values: ['a', 'b', 'c', 'd'],
                value: 'b',
                orderable: true
            },
            {
                name: 'awesome',
                type: 'select',
                values: ['1', '2', '3']
            }
        ],

        instantFilter: true,
        filterSchema: [
            {
                name: "Maximum_Awesome",
                label: "Awesome",
                type: 'select',
                values: ['1', '2', '3'],
                value: '3'
            },
            {
                name: "Search_Textarea",
                label: "Textarea",
                type: 'text'
            },
            {
                name: "fruit",
                type: 'checkbox',
                values: ['apple', 'orange']
            }
        ],

        createFormTemplate: function () {
            var that = this;
            var ID = that.uniqueID();
            return '' +
            '<form class="form-horizontal crud-save-form" role="form">' +
                '<legend>' +
                    that.name +
                    '<span class="pull-right status">' +
                        '{{status}}' +
                        '<span class="glyphicon glyphicon-save pull-right"></span>' +
                    '</span>' +
                '</legend>' +
                reduceSchemaToForm({
                    schema: that.schema,
                    createInput: that.createInput,
                    ID: ID
                }) +
                '<div class="form-group">' +
                    '<div class="col-sm-offset-3 col-sm-9">' +
                        '<input type="submit" class="btn btn-lg btn-primary" value="Save"/>' +
                        '<button class="crud-new-item btn btn-lg btn-success">' +
                            'New ' + that.name +
                        '</button>' +
                    '</div>' +
                '</div>' +
            '</form>';
        },

        createFilterTemplate: function () {
            var that = this;
            var ID = that.uniqueID();
            return '' +
            '<form class="form-horizontal well" role="form">' +
                '<legend>Search ' + that.name + '</legend>' +
                reduceSchemaToForm({
                    schema: that.filterSchema,
                    createInput: that.createInput,
                    ID: ID
                }) +
                (
                    that.isInstantFilter ?
                        '' : '' +
                        '<div class="form-group">' +
                            '<div class="col-sm-offset-3 col-sm-2">' +
                                '<input type="submit" class="btn btn-info btn-lg" value="Search"/>' +
                            '</div>' +
                        '</div>'
                ) +
            '</form>';
        },

        createListTemplate: function () {
            var that = this;
            var ID = that.uniqueID();
            return '' +
            '<table class="table table-hover">' +
                '<thead>' +
                    '<tr>' +
                        (
                            that.deletable ?
                            '<th>' +
                                '<label for="' + ID + '-crud-list-select-all">All</label>' +
                                '<input type="checkbox" id="' + ID + '-crud-list-select-all" ' +
                                       'class="crud-list-select-all"/>' +
                            '</th>' : ''
                        ) +
                        (
                            that.id ?
                            '<th>' +
                                that.orderable('id') +
                                '<span class="crud-th-content">' +
                                    (that.id.label || 'id') +
                                '</span>' +
                            '</th>' : ''
                        ) +
                        reduce(that.schema, function (acc, item) {
                            return (acc || '') +
                            '<th>' +
                                that.orderable(item.name) +
                                (item.label || item.name) +
                            '</th>';
                        }) +
                    '</tr>' +
                '</thead>' +
                '<tbody class="crud-list-item-container"></tbody>' +
            '</table>' +
            (that.deletable ?
                '<button class="crud-delete-selected btn btn-danger">' +
                    'Delete Selected' +
                '</button>' : '');
        },

        createListItemTemplate: function () {
            var that = this;
            return '' +
            (that.deletable ?
                '<td><input type="checkbox" class="crud-list-selected"/></td>' : ''
            ) +
            (that.id ? '<td>{{id}}</td>' : '') +
            reduce(that.schema, function (acc, item) {
                return (acc || '') + '<td>{{' + item.name + '}}</td>';
            });
        },

        createPaginatorTemplate: function () {
            return '' +
            '<ul class="crud-pages pagination">' +
                '{{#pages}}' +
                    '<li><a data-page-number="{{.}}" href="#">{{.}}</a></li>' +
                '{{/pages}}' +
            '</ul>' +
            '<form class="crud-goto-page-form form-inline" role="form">' +
                '<div class="form-group">' +
                    '<label>{{numberOfPages}} pages &nbsp;</label>' +
                '</div>' +
                '<div class="form-group">' +
                    '<input type="text" class="form-control" name="goto-page" ' +
                        'placeholder="page #"/>' +
                '</div>' +
                '<div class="form-group">' +
                    '<input type="submit" class="btn btn-info" value="Go"/>' +
                '</div>' +
            '</form>';
        },

        createDeleteConfirmationTemplate: function () {
            return '' +
            '<div class="crud-delete-modal modal">' +
                '<center>' +
                    '<p>Sure you want to delete the checked items?</p>' +
                    '<button class="crud-confirm-delete btn btn-danger">' +
                        'Delete' +
                    '</button>' +
                    '<button class="crud-cancel-delete btn">' +
                        'Cancel' +
                    '</button>' +
                '</center>' +
            '</div>';
        }
    });
});
</script>
</body>
</html>
